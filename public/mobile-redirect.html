<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .redirect-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 400px;
      width: 100%;
    }
    
    .icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.8em;
    }
    
    .message {
      color: #6c757d;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    
    .browser-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      text-decoration: none;
      display: inline-block;
      margin: 10px;
      transition: transform 0.2s ease;
    }
    
    .browser-btn:hover {
      transform: translateY(-2px);
    }
    
    .copy-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .url-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: monospace;
      font-size: 14px;
      margin: 10px 0;
      text-align: center;
    }
    
    .copy-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .steps {
      text-align: left;
      margin: 20px 0;
    }
    
    .step {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="redirect-container">
    <div class="icon">ğŸ“±</div>
    <h1>æ¬¢è¿å‚åŠ è´­ç‰©å®éªŒ</h1>
    
    <div class="warning">
      <strong>ğŸ“± ä¸ºäº†è·å¾—æœ€ä½³ä½“éªŒï¼š</strong><br>
      è¯·åœ¨æ‰‹æœºé»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€å®éªŒé¡µé¢ï¼Œä»¥è·å¾—æ›´å¥½çš„æ˜¾ç¤ºæ•ˆæœã€‚
    </div>
    
    <div class="message">
      ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è·³è½¬åˆ°æ‚¨çš„æ‰‹æœºæµè§ˆå™¨ï¼ˆå¦‚Safariã€Chromeç­‰ï¼‰ã€‚
    </div>
    
    <div class="steps">
      <div class="step">
        <strong>æ–¹æ³•1ï¼šç‚¹å‡»ä¸‹æ–¹æŒ‰é’®</strong><br>
        å°è¯•åœ¨é»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€
      </div>
      <div class="step">
        <strong>æ–¹æ³•2ï¼šå¤åˆ¶é“¾æ¥</strong><br>
        æ‰‹åŠ¨å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨
      </div>
      <div class="step">
        <strong>æ–¹æ³•3ï¼šå¾®ä¿¡æ“ä½œ</strong><br>
        ç‚¹å‡»å³ä¸Šè§’"..." â†’ "åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"
      </div>
    </div>
    
    <a href="javascript:void(0)" class="browser-btn" onclick="openInBrowser()">
      ğŸŒ å¼€å§‹å®éªŒ
    </a>
    
    <div class="copy-section">
      <p><strong>æˆ–å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ°æµè§ˆå™¨ï¼š</strong></p>
      <input type="text" class="url-input" id="url-input" value="http://47.86.24.59:3000/experiment/consent.html" readonly>
      <br>
      <button class="copy-btn" onclick="copyUrl()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
    </div>
    
    <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">
      å¦‚æœé¡µé¢æ— æ³•æ­£å¸¸åŠ è½½ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œè¯·ç¨åé‡è¯•
    </div>
  </div>

  <script>
    // å°è¯•åœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€
    function openInBrowser() {
      const url = 'http://47.86.24.59:3000/experiment/consent.html';
      
      // æ£€æµ‹æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¯å¢ƒ
      const userAgent = navigator.userAgent.toLowerCase();
      const isAndroid = userAgent.indexOf('android') > -1;
      const isIOS = /iphone|ipad|ipod/.test(userAgent);
      const isWeChat = userAgent.indexOf('micromessenger') > -1;
      const isQQ = userAgent.indexOf('qq/') > -1;
      
      console.log('è®¾å¤‡ç±»å‹:', isAndroid ? 'Android' : isIOS ? 'iOS' : 'Other');
      console.log('åº”ç”¨ç¯å¢ƒ:', isWeChat ? 'å¾®ä¿¡' : isQQ ? 'QQ' : 'å…¶ä»–');
      
      if (isWeChat) {
        // å¾®ä¿¡ç¯å¢ƒ - ä½¿ç”¨å¾®ä¿¡å¼€æ”¾æ ‡ç­¾å¼ºåˆ¶è·³è½¬
        if (window.wx) {
          window.wx.miniProgram.navigateTo({
            url: `/pages/webview/webview?url=${encodeURIComponent(url)}`
          });
        } else {
          // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨å¾®ä¿¡å¼€æ”¾æ ‡ç­¾
          const link = document.createElement('a');
          link.href = url;
          link.setAttribute('data-miniprogram-appid', '');
          link.setAttribute('data-miniprogram-path', '');
          link.setAttribute('data-miniprogram-navigate-type', '2');
          link.click();
        }
      } else if (isAndroid) {
        // Android è®¾å¤‡ - ä½¿ç”¨æ›´å¼ºçš„è·³è½¬æ–¹å¼
        try {
          // æ–¹æ³•1: å°è¯•ä½¿ç”¨ Chrome Intent
          const chromeIntent = `intent://47.86.24.59:3000/experiment/consent.html#Intent;scheme=http;package=com.android.chrome;S.browser_fallback_url=${encodeURIComponent(url)};end`;
          window.location.href = chromeIntent;
          
          // æ–¹æ³•2: å¦‚æœChromeä¸å¯ç”¨ï¼Œå°è¯•é»˜è®¤æµè§ˆå™¨
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              const defaultIntent = `intent://47.86.24.59:3000/experiment/consent.html#Intent;scheme=http;package=com.android.browser;end`;
              window.location.href = defaultIntent;
            }
          }, 1000);
          
          // æ–¹æ³•3: æœ€åçš„å¤‡ç”¨æ–¹æ¡ˆ
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              window.location.href = url;
            }
          }, 3000);
          
        } catch (e) {
          window.location.href = url;
        }
        
      } else if (isIOS) {
        // iOS è®¾å¤‡ - å°è¯•å¤šç§æ–¹å¼
        try {
          // æ–¹æ³•1: å°è¯•ä½¿ç”¨ Safari è‡ªå®šä¹‰åè®®
          const safariUrl = `x-safari-${url}`;
          window.location.href = safariUrl;
          
          // æ–¹æ³•2: ä½¿ç”¨é€šç”¨é“¾æ¥
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              window.location.href = url;
            }
          }, 1000);
          
        } catch (e) {
          window.location.href = url;
        }
        
      } else {
        // å…¶ä»–è®¾å¤‡
        window.location.href = url;
      }
    }
    
    // å¤åˆ¶é“¾æ¥åŠŸèƒ½
    function copyUrl() {
      const urlInput = document.getElementById('url-input');
      urlInput.select();
      urlInput.setSelectionRange(0, 99999); // ç§»åŠ¨ç«¯å…¼å®¹
      
      try {
        document.execCommand('copy');
        alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nè¯·åœ¨æµè§ˆå™¨ä¸­ç²˜è´´å¹¶è®¿é—®');
      } catch (err) {
        // å¤‡ç”¨æ–¹æ¡ˆ
        if (navigator.clipboard) {
          navigator.clipboard.writeText(urlInput.value).then(() => {
            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nè¯·åœ¨æµè§ˆå™¨ä¸­ç²˜è´´å¹¶è®¿é—®');
          });
        } else {
          alert('è¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ï¼š' + urlInput.value);
        }
      }
    }
    
    // æ£€æµ‹å½“å‰ç¯å¢ƒ
    const userAgent = navigator.userAgent.toLowerCase();
    const isWeChat = userAgent.indexOf('micromessenger') > -1;
    const isQQ = userAgent.indexOf('qq/') > -1;
    const isAlipay = userAgent.indexOf('alipay') > -1;
    
    if (isWeChat) {
      document.querySelector('.icon').textContent = 'ğŸ’¬';
      document.querySelector('h1').textContent = 'å¾®ä¿¡æµè§ˆå™¨é™åˆ¶';
    } else if (isQQ) {
      document.querySelector('.icon').textContent = 'ğŸ§';
      document.querySelector('h1').textContent = 'QQæµè§ˆå™¨é™åˆ¶';
    } else if (isAlipay) {
      document.querySelector('.icon').textContent = 'ğŸ’°';
      document.querySelector('h1').textContent = 'æ”¯ä»˜å®æµè§ˆå™¨é™åˆ¶';
    }
    
    // è‡ªåŠ¨å°è¯•è·³è½¬ï¼ˆå»¶è¿Ÿ3ç§’ï¼‰
    setTimeout(() => {
      if (confirm('æ˜¯å¦å°è¯•åœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Ÿ')) {
        openInBrowser();
      }
    }, 3000);
  </script>
</body>
</html>