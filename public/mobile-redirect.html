<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>请在浏览器中打开</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .redirect-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 400px;
      width: 100%;
    }
    
    .icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.8em;
    }
    
    .message {
      color: #6c757d;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    
    .browser-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      text-decoration: none;
      display: inline-block;
      margin: 10px;
      transition: transform 0.2s ease;
    }
    
    .browser-btn:hover {
      transform: translateY(-2px);
    }
    
    .copy-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .url-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: monospace;
      font-size: 14px;
      margin: 10px 0;
      text-align: center;
    }
    
    .copy-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .steps {
      text-align: left;
      margin: 20px 0;
    }
    
    .step {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .browser-hint {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #667eea;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      max-width: 200px;
      animation: pulse 2s infinite;
    }
    
    .hint-arrow {
      font-size: 20px;
      text-align: center;
      margin-bottom: 5px;
    }
    
    .hint-text {
      font-size: 12px;
      color: #667eea;
      font-weight: 600;
      text-align: center;
      line-height: 1.3;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="redirect-container">
    <div class="icon">📱</div>
    <h1>欢迎参加购物实验</h1>
    
    <div class="browser-hint" id="browser-hint">
      <div class="hint-arrow">↗️</div>
      <div class="hint-text">请点击右上角"..."选择"在浏览器中打开"</div>
    </div>
    
    <div class="warning">
      <strong>📱 为了获得最佳体验：</strong><br>
      请在手机默认浏览器中打开实验页面，以获得更好的显示效果。
    </div>
    
    <div class="message">
      点击下方按钮，系统将自动跳转到您的手机浏览器（如Safari、Chrome等）。
    </div>
    
    <div class="steps">
      <div class="step">
        <strong>方法1：点击下方按钮</strong><br>
        尝试在默认浏览器中打开
      </div>
      <div class="step">
        <strong>方法2：复制链接</strong><br>
        手动复制链接到浏览器
      </div>
      <div class="step">
        <strong>方法3：微信操作</strong><br>
        点击右上角"..." → "在浏览器中打开"
      </div>
    </div>
    
    <a href="javascript:void(0)" class="browser-btn" onclick="openInBrowser()">
      🌐 开始实验
    </a>
    
    <div class="copy-section">
      <p><strong>或复制以下链接到浏览器：</strong></p>
      <input type="text" class="url-input" id="url-input" value="http://47.86.24.59:3000/experiment/consent.html" readonly>
      <br>
      <button class="copy-btn" onclick="copyUrl()">📋 复制链接</button>
    </div>
    
    <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">
      如果页面无法正常加载，可能是网络问题，请稍后重试
    </div>
  </div>

  <script>
    // 尝试在外部浏览器中打开
    function openInBrowser() {
      // 隐藏右上角提示
      const hint = document.getElementById('browser-hint');
      if (hint) hint.style.display = 'none';
      
      // 显示二次提示
      showSecondaryHint();
      
      const url = 'http://47.86.24.59:3000/experiment/consent.html';
      
      // 检测操作系统和应用环境
      const userAgent = navigator.userAgent.toLowerCase();
      const isAndroid = userAgent.indexOf('android') > -1;
      const isIOS = /iphone|ipad|ipod/.test(userAgent);
      const isWeChat = userAgent.indexOf('micromessenger') > -1;
      const isQQ = userAgent.indexOf('qq/') > -1;
      
      console.log('设备类型:', isAndroid ? 'Android' : isIOS ? 'iOS' : 'Other');
      console.log('应用环境:', isWeChat ? '微信' : isQQ ? 'QQ' : '其他');
      
      if (isWeChat) {
        // 微信环境 - 使用微信开放标签强制跳转
        if (window.wx) {
          window.wx.miniProgram.navigateTo({
            url: `/pages/webview/webview?url=${encodeURIComponent(url)}`
          });
        } else {
          // 备用方案：使用微信开放标签
          const link = document.createElement('a');
          link.href = url;
          link.setAttribute('data-miniprogram-appid', '');
          link.setAttribute('data-miniprogram-path', '');
          link.setAttribute('data-miniprogram-navigate-type', '2');
          link.click();
        }
      } else if (isAndroid) {
        // Android 设备 - 使用更强的跳转方式
        try {
          // 方法1: 尝试使用 Chrome Intent
          const chromeIntent = `intent://47.86.24.59:3000/experiment/consent.html#Intent;scheme=http;package=com.android.chrome;S.browser_fallback_url=${encodeURIComponent(url)};end`;
          window.location.href = chromeIntent;
          
          // 方法2: 如果Chrome不可用，尝试默认浏览器
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              const defaultIntent = `intent://47.86.24.59:3000/experiment/consent.html#Intent;scheme=http;package=com.android.browser;end`;
              window.location.href = defaultIntent;
            }
          }, 1000);
          
          // 方法3: 最后的备用方案
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              window.location.href = url;
            }
          }, 3000);
          
        } catch (e) {
          window.location.href = url;
        }
        
      } else if (isIOS) {
        // iOS 设备 - 尝试多种方式
        try {
          // 方法1: 尝试使用 Safari 自定义协议
          const safariUrl = `x-safari-${url}`;
          window.location.href = safariUrl;
          
          // 方法2: 使用通用链接
          setTimeout(() => {
            if (document.visibilityState === 'visible') {
              window.location.href = url;
            }
          }, 1000);
          
        } catch (e) {
          window.location.href = url;
        }
        
      } else {
        // 其他设备
        window.location.href = url;
      }
    }
    
    // 显示二次提示
    function showSecondaryHint() {
      const hintModal = document.createElement('div');
      hintModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      `;
      
      hintModal.innerHTML = `
        <div style="
          background: white;
          border-radius: 16px;
          padding: 30px;
          margin: 20px;
          max-width: 350px;
          text-align: center;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        ">
          <div style="font-size: 24px; margin-bottom: 15px;">📱</div>
          <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px;">请在浏览器中打开</h3>
          <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.5; font-size: 14px;">
            为了获得最佳体验，请在手机默认浏览器中打开此页面。
            <br><br>
            如果自动跳转失败，请点击右上角"..."选择"在浏览器中打开"。
          </p>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
          ">我知道了</button>
        </div>
      `;
      
      document.body.appendChild(hintModal);
      
      // 3秒后自动关闭
      setTimeout(() => {
        if (hintModal.parentElement) {
          hintModal.remove();
        }
      }, 3000);
    }
    
    // 复制链接功能
    function copyUrl() {
      const urlInput = document.getElementById('url-input');
      urlInput.select();
      urlInput.setSelectionRange(0, 99999); // 移动端兼容
      
      try {
        document.execCommand('copy');
        alert('链接已复制到剪贴板！\n请在浏览器中粘贴并访问');
      } catch (err) {
        // 备用方案
        if (navigator.clipboard) {
          navigator.clipboard.writeText(urlInput.value).then(() => {
            alert('链接已复制到剪贴板！\n请在浏览器中粘贴并访问');
          });
        } else {
          alert('请手动复制链接：' + urlInput.value);
        }
      }
    }
    
    // 检测当前环境
    const userAgent = navigator.userAgent.toLowerCase();
    const isWeChat = userAgent.indexOf('micromessenger') > -1;
    const isQQ = userAgent.indexOf('qq/') > -1;
    const isAlipay = userAgent.indexOf('alipay') > -1;
    
    if (isWeChat) {
      document.querySelector('.icon').textContent = '💬';
      document.querySelector('h1').textContent = '微信浏览器限制';
    } else if (isQQ) {
      document.querySelector('.icon').textContent = '🐧';
      document.querySelector('h1').textContent = 'QQ浏览器限制';
    } else if (isAlipay) {
      document.querySelector('.icon').textContent = '💰';
      document.querySelector('h1').textContent = '支付宝浏览器限制';
    }
    
    // 自动尝试跳转（延迟3秒）
    setTimeout(() => {
      if (confirm('是否尝试在外部浏览器中打开？')) {
        openInBrowser();
      }
    }, 3000);
  </script>
</body>
</html>